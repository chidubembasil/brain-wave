<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Registration - BrainWave</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-gradient: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%);
            --primary-color: #1e3a8a;
            --primary-dark: #1e40af;
            --secondary-color: #3b82f6;
            --success-color: #10b981;
            --danger-color: #ef4444;
            --warning-color: #f59e0b;
            --white: #ffffff;
            --gray-50: #f9fafb;
            --gray-100: #f3f4f6;
            --gray-200: #e5e7eb;
            --gray-300: #d1d5db;
            --gray-500: #6b7280;
            --gray-700: #374151;
            --gray-900: #111827;
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 2rem;
        }

        .signup-container {
            background: var(--white);
            border-radius: 20px;
            box-shadow: var(--shadow-xl);
            max-width: 500px;
            width: 100%;
            overflow: hidden;
        }

        .signup-header {
            background: var(--primary-gradient);
            padding: 2.5rem 2rem;
            text-align: center;
            color: var(--white);
        }

        .logo {
            width: 60px;
            height: 60px;
            margin: 0 auto 1rem;
            background: var(--white);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            color: var(--primary-color);
        }

        .signup-header h1 {
            font-size: 1.75rem;
            margin-bottom: 0.5rem;
            font-weight: 700;
        }

        .signup-header p {
            font-size: 0.95rem;
            opacity: 0.95;
        }

        .badge {
            display: inline-block;
            background: rgba(255, 255, 255, 0.2);
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-top: 0.5rem;
            backdrop-filter: blur(10px);
        }

        .signup-form {
            padding: 2rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: var(--gray-700);
            font-weight: 600;
            font-size: 0.9rem;
        }

        .form-group label .required {
            color: var(--danger-color);
            margin-left: 0.25rem;
        }

        .input-wrapper {
            position: relative;
        }

        .input-icon {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--gray-500);
            font-size: 1rem;
        }

        .form-control {
            width: 100%;
            padding: 0.875rem 1rem 0.875rem 2.75rem;
            border: 2px solid var(--gray-200);
            border-radius: 10px;
            font-size: 0.95rem;
            transition: all 0.3s ease;
            background: var(--gray-50);
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary-color);
            background: var(--white);
            box-shadow: 0 0 0 3px rgba(30, 58, 138, 0.1);
        }

        .form-control.error {
            border-color: var(--danger-color);
        }

        .error-message {
            color: var(--danger-color);
            font-size: 0.8rem;
            margin-top: 0.5rem;
            display: none;
        }

        .error-message.show {
            display: block;
        }

        .password-toggle {
            position: absolute;
            right: 1rem;
            top: 50%;
            transform: translateY(-50%);
            cursor: pointer;
            color: var(--gray-500);
            font-size: 1rem;
        }

        .password-toggle:hover {
            color: var(--primary-color);
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .security-note {
            background: var(--gray-50);
            border-left: 4px solid var(--warning-color);
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1.5rem;
        }

        .security-note .icon {
            color: var(--warning-color);
            margin-right: 0.5rem;
        }

        .security-note p {
            font-size: 0.85rem;
            color: var(--gray-700);
            margin: 0;
        }

        .btn-signup {
            width: 100%;
            padding: 1rem;
            background: var(--primary-gradient);
            color: var(--white);
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px rgba(30, 58, 138, 0.2);
        }

        .btn-signup:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(30, 58, 138, 0.3);
        }

        .btn-signup:active {
            transform: translateY(0);
        }

        .btn-signup:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .login-link {
            text-align: center;
            margin-top: 1.5rem;
            padding-top: 1.5rem;
            border-top: 1px solid var(--gray-200);
        }

        .login-link p {
            color: var(--gray-700);
            font-size: 0.9rem;
        }

        .login-link a {
            color: var(--primary-color);
            text-decoration: none;
            font-weight: 600;
        }

        .login-link a:hover {
            text-decoration: underline;
        }

        .toast {
            position: fixed;
            top: 2rem;
            right: 2rem;
            background: var(--white);
            padding: 1rem 1.5rem;
            border-radius: 10px;
            box-shadow: var(--shadow-xl);
            display: none;
            align-items: center;
            gap: 0.75rem;
            z-index: 1000;
            animation: slideIn 0.3s ease;
        }

        .toast.show {
            display: flex;
        }

        .toast.success {
            border-left: 4px solid var(--success-color);
        }

        .toast.error {
            border-left: 4px solid var(--danger-color);
        }

        .toast-icon {
            font-size: 1.25rem;
        }

        .toast.success .toast-icon {
            color: var(--success-color);
        }

        .toast.error .toast-icon {
            color: var(--danger-color);
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }

            .signup-container {
                margin: 1rem;
            }
        }
    </style>
</head>
<body>
    <div class="signup-container">
        <div class="signup-header">
            <div class="logo">
                <i class="fas fa-user-shield"></i>
            </div>
            <h1>Admin Registration</h1>
            <p>Create your administrator account</p>
            <span class="badge"><i class="fas fa-lock"></i> Secure Access</span>
        </div>

        <form class="signup-form" id="adminSignupForm">
            <div class="security-note">
                <i class="fas fa-exclamation-triangle icon"></i>
                <p><strong>Important:</strong> This registration is for authorized administrators only. Unauthorized access attempts will be logged and reported.</p>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="firstName">First Name<span class="required">*</span></label>
                    <div class="input-wrapper">
                        <i class="fas fa-user input-icon"></i>
                        <input type="text" id="firstName" class="form-control" placeholder="John" required>
                    </div>
                    <span class="error-message" id="firstNameError">Please enter your first name</span>
                </div>

                <div class="form-group">
                    <label for="lastName">Last Name<span class="required">*</span></label>
                    <div class="input-wrapper">
                        <i class="fas fa-user input-icon"></i>
                        <input type="text" id="lastName" class="form-control" placeholder="Doe" required>
                    </div>
                    <span class="error-message" id="lastNameError">Please enter your last name</span>
                </div>
            </div>

            <div class="form-group">
                <label for="email">Email Address<span class="required">*</span></label>
                <div class="input-wrapper">
                    <i class="fas fa-envelope input-icon"></i>
                    <input type="email" id="email" class="form-control" placeholder="admin@brainwave.com" required>
                </div>
                <span class="error-message" id="emailError">Please enter a valid email address</span>
            </div>

            <div class="form-group">
                <label for="phone">Phone Number<span class="required">*</span></label>
                <div class="input-wrapper">
                    <i class="fas fa-phone input-icon"></i>
                    <input type="tel" id="phone" class="form-control" placeholder="+234 800 000 0000" required>
                </div>
                <span class="error-message" id="phoneError">Please enter a valid phone number</span>
            </div>

            <div class="form-group">
                <label for="password">Password<span class="required">*</span></label>
                <div class="input-wrapper">
                    <i class="fas fa-lock input-icon"></i>
                    <input type="password" id="password" class="form-control" placeholder="Create a strong password" required>
                    <i class="fas fa-eye password-toggle" id="togglePassword"></i>
                </div>
                <span class="error-message" id="passwordError">Password must be at least 8 characters</span>
            </div>

            <div class="form-group">
                <label for="confirmPassword">Confirm Password<span class="required">*</span></label>
                <div class="input-wrapper">
                    <i class="fas fa-lock input-icon"></i>
                    <input type="password" id="confirmPassword" class="form-control" placeholder="Re-enter your password" required>
                    <i class="fas fa-eye password-toggle" id="toggleConfirmPassword"></i>
                </div>
                <span class="error-message" id="confirmPasswordError">Passwords do not match</span>
            </div>

            <div class="form-group">
                <div style="display: flex; align-items: start; gap: 0.75rem; padding: 1rem; background: var(--gray-50); border-radius: 10px;">
                    <input type="checkbox" id="terms" style="margin-top: 0.25rem; width: 18px; height: 18px; cursor: pointer;" required>
                    <label for="terms" style="margin: 0; font-size: 0.9rem; cursor: pointer; color: var(--gray-700); line-height: 1.5;">
                        I agree to the <a href="#" onclick="showTerms(); return false;" style="color: var(--primary-color); text-decoration: none; font-weight: 600;">Terms and Conditions</a> and <a href="#" onclick="showPrivacy(); return false;" style="color: var(--primary-color); text-decoration: none; font-weight: 600;">Privacy Policy</a>
                    </label>
                </div>
                <span class="error-message" id="termsError">You must agree to the terms and conditions</span>
            </div>

            <button type="submit" class="btn-signup">
                <i class="fas fa-user-plus"></i> Create Admin Account
            </button>

            <div class="login-link">
                <p>Already have an admin account? <a href="admin-login.html">Sign In</a></p>
            </div>
        </form>
    </div>

    <div class="toast" id="toast">
        <i class="fas fa-check-circle toast-icon"></i>
        <span id="toastMessage">Success!</span>
    </div>

    <script type="module">
        import { auth, db, createUserWithEmailAndPassword, sendEmailVerification, setDoc, doc, serverTimestamp } from './firebase-config.js';

        // Toggle password visibility
        document.getElementById('togglePassword').addEventListener('click', function() {
            const password = document.getElementById('password');
            const icon = this;
            if (password.type === 'password') {
                password.type = 'text';
                icon.classList.remove('fa-eye');
                icon.classList.add('fa-eye-slash');
            } else {
                password.type = 'password';
                icon.classList.remove('fa-eye-slash');
                icon.classList.add('fa-eye');
            }
        });

        document.getElementById('toggleConfirmPassword').addEventListener('click', function() {
            const confirmPassword = document.getElementById('confirmPassword');
            const icon = this;
            if (confirmPassword.type === 'password') {
                confirmPassword.type = 'text';
                icon.classList.remove('fa-eye');
                icon.classList.add('fa-eye-slash');
            } else {
                confirmPassword.type = 'password';
                icon.classList.remove('fa-eye-slash');
                icon.classList.add('fa-eye');
            }
        });

        // Form validation
        function validateForm() {
            let isValid = true;

            // First Name
            const firstName = document.getElementById('firstName');
            if (firstName.value.trim() === '') {
                showError('firstName', 'Please enter your first name');
                isValid = false;
            } else {
                hideError('firstName');
            }

            // Last Name
            const lastName = document.getElementById('lastName');
            if (lastName.value.trim() === '') {
                showError('lastName', 'Please enter your last name');
                isValid = false;
            } else {
                hideError('lastName');
            }

            // Email
            const email = document.getElementById('email');
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(email.value)) {
                showError('email', 'Please enter a valid email address');
                isValid = false;
            } else {
                hideError('email');
            }

            // Phone
            const phone = document.getElementById('phone');
            if (phone.value.trim().length < 10) {
                showError('phone', 'Please enter a valid phone number');
                isValid = false;
            } else {
                hideError('phone');
            }

            // Password
            const password = document.getElementById('password');
            if (password.value.length < 8) {
                showError('password', 'Password must be at least 8 characters');
                isValid = false;
            } else {
                hideError('password');
            }

            // Confirm Password
            const confirmPassword = document.getElementById('confirmPassword');
            if (confirmPassword.value !== password.value) {
                showError('confirmPassword', 'Passwords do not match');
                isValid = false;
            } else {
                hideError('confirmPassword');
            }

            // Terms and Conditions
            const terms = document.getElementById('terms');
            if (!terms.checked) {
                showError('terms', 'You must agree to the terms and conditions');
                isValid = false;
            } else {
                hideError('terms');
            }

            return isValid;
        }

        function showError(fieldId, message) {
            const field = document.getElementById(fieldId);
            const errorElement = document.getElementById(fieldId + 'Error');
            field.classList.add('error');
            errorElement.textContent = message;
            errorElement.classList.add('show');
        }

        function hideError(fieldId) {
            const field = document.getElementById(fieldId);
            const errorElement = document.getElementById(fieldId + 'Error');
            field.classList.remove('error');
            errorElement.classList.remove('show');
        }

        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            const toastMessage = document.getElementById('toastMessage');
            const toastIcon = toast.querySelector('.toast-icon');

            toastMessage.textContent = message;
            toast.className = `toast ${type} show`;

            if (type === 'success') {
                toastIcon.className = 'fas fa-check-circle toast-icon';
            } else {
                toastIcon.className = 'fas fa-exclamation-circle toast-icon';
            }

            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // Form submission
        document.getElementById('adminSignupForm').addEventListener('submit', async function(e) {
            e.preventDefault();

            if (!validateForm()) {
                showToast('Please fix the errors in the form', 'error');
                return;
            }

            const submitBtn = this.querySelector('button[type="submit"]');
            submitBtn.textContent = 'Creating Account...';
            submitBtn.disabled = true;

            try {
                // Get form data
                const firstName = document.getElementById('firstName').value.trim();
                const lastName = document.getElementById('lastName').value.trim();
                const email = document.getElementById('email').value.trim();
                const phone = document.getElementById('phone').value.trim();
                const password = document.getElementById('password').value;

                console.log('ðŸ” Creating Firebase Auth admin user...');

                // Create Firebase Authentication user
                const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                const user = userCredential.user;

                console.log('âœ… Firebase admin user created:', user.uid);
                console.log('ðŸ“§ Sending verification email...');

                // Send email verification with action code settings
                try {
                    const actionCodeSettings = {
                        url: window.location.origin + '/admin-email-confirmation.html',
                        handleCodeInApp: false
                    };
                    await sendEmailVerification(user, actionCodeSettings);
                    console.log('âœ… Verification email sent to:', user.email);
                } catch (emailError) {
                    console.error('âŒ Email verification failed:', emailError);
                    console.error('Error code:', emailError.code);
                    console.error('Error message:', emailError.message);
                    alert('âš ï¸ Warning: Could not send verification email. Error: ' + emailError.message);
                }

                // Prepare admin data for Firestore
                const adminData = {
                    firstName: firstName,
                    lastName: lastName,
                    name: `${firstName} ${lastName}`,
                    email: email,
                    phone: phone,
                    role: 'admin',
                    status: 'active',
                    emailVerified: false,
                    verifiedAt: null,
                    createdAt: serverTimestamp(),
                    updatedAt: serverTimestamp(),
                    permissions: {
                        users: true,
                        content: true,
                        assessments: true,
                        reports: true,
                        settings: true
                    }
                };

                console.log('ðŸ’¾ Saving admin data to Firestore...');

                // Save admin data to Firestore
                await setDoc(doc(db, 'admins', user.uid), adminData);
                console.log('âœ… Admin data saved to Firestore');

                // Store email for confirmation page
                localStorage.setItem('pendingAdminEmail', email);

                // Show success message
                showToast('Admin account created successfully!', 'success');

                // Redirect to email confirmation page after 2 seconds
                setTimeout(() => {
                    window.location.href = 'admin-email-confirmation.html';
                }, 2000);

            } catch (error) {
                console.error('Admin signup error:', error);
                submitBtn.textContent = 'Create Admin Account';
                submitBtn.disabled = false;

                // Handle specific Firebase errors
                if (error.code === 'auth/email-already-in-use') {
                    showToast('An account with this email already exists', 'error');
                } else if (error.code === 'auth/weak-password') {
                    showToast('Password is too weak. Please use a stronger password.', 'error');
                } else if (error.code === 'auth/invalid-email') {
                    showToast('Invalid email address', 'error');
                } else {
                    showToast('Error creating account: ' + error.message, 'error');
                }
            }
        });

        // Real-time validation
        document.getElementById('email').addEventListener('blur', function() {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(this.value)) {
                showError('email', 'Please enter a valid email address');
            } else {
                hideError('email');
            }
        });

        document.getElementById('confirmPassword').addEventListener('input', function() {
            const password = document.getElementById('password').value;
            if (this.value !== password && this.value.length > 0) {
                showError('confirmPassword', 'Passwords do not match');
            } else {
                hideError('confirmPassword');
            }
        });

        // Show Terms and Conditions modal
        function showTerms() {
            alert('Terms and Conditions:\n\n1. This admin account is for authorized personnel only\n2. You agree to use this platform responsibly\n3. Unauthorized access or misuse will result in account termination\n4. You are responsible for maintaining the confidentiality of your account\n5. BrainWave reserves the right to modify these terms at any time');
        }

        // Show Privacy Policy modal
        function showPrivacy() {
            alert('Privacy Policy:\n\n1. We collect and store your personal information securely\n2. Your data will not be shared with third parties without consent\n3. We use industry-standard encryption to protect your data\n4. You have the right to request deletion of your data at any time\n5. We comply with all applicable data protection regulations');
        }
    </script>
</body>
</html>
